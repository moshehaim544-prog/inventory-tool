<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת אופטימיזציית מלאי PS</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container" id="report">
        <header>
            <h1>מערכת אופטימיזציית מלאי PS</h1>
            <p>ניהול תרחישים, סיכונים ורכש</p>
        </header>

        <div class="main-grid">
            <section class="card">
                <div class="card-header">📋 הזנת נתונים ותרחישים</div>
                
                <div class="input-section">
                    <label>בחר תרחיש עבודה:</label>
                    <select id="scenario" onchange="loadScenarioData()">
                        <option value="1">תרחיש א'</option>
                        <option value="2">תרחיש ב'</option>
                    </select>
                </div>

                <h3>תחזית מכירות (Forecast)</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>סוג</th>
                            <th>כמות</th>
                            <th>סיכוי (%)</th>
                            <th>משוקלל</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AC</td>
                            <td><input type="number" id="forAC" value="40" oninput="calculate()"></td>
                            <td><input type="number" id="probAC" value="60" oninput="calculate()"></td>
                            <td id="weightAC" class="bold">24</td>
                        </tr>
                        <tr>
                            <td>DC</td>
                            <td><input type="number" id="forDC" value="10" oninput="calculate()"></td>
                            <td><input type="number" id="probDC" value="100" oninput="calculate()"></td>
                            <td id="weightDC" class="bold">10</td>
                        </tr>
                    </tbody>
                </table>

                <h3>מלאי ורכש</h3>
                <div class="input-grid">
                    <div class="field">
                        <label>מלאי AC נוכחי</label>
                        <input type="number" id="currAC" value="130" oninput="calculate()">
                    </div>
                    <div class="field">
                        <label>מלאי DC נוכחי</label>
                        <input type="number" id="currDC" value="74" oninput="calculate()">
                    </div>
                    <div class="field highlight">
                        <label>הזמנת קיט AC</label>
                        <input type="number" id="buyAC" value="0" oninput="calculate()">
                    </div>
                    <div class="field highlight">
                        <label>הזמנת קיט DC</label>
                        <input type="number" id="buyDC" value="0" oninput="calculate()">
                    </div>
                </div>

                <div class="field">
                    <label>יעד אחוז AC מבוקש (%)</label>
                    <input type="number" id="target" value="78" oninput="calculate()">
                </div>
                
                <button class="btn-opt no-print" onclick="optimize()">✨ חשב המלצה אופטימלית</button>
            </section>

            <section class="card">
                <div class="card-header">📊 ניתוח והמלצות</div>
                
                <div id="status" class="alert">--</div>

                <div class="result-item">
                    <span>יחס מלאי סופי:</span>
                    <span id="finalRatio" class="bold">--</span>
                </div>
                <div class="progress-container">
                    <div id="progBar" class="progress-bar"></div>
                </div>

                <div class="spares-grid">
                    <div class="spare-box">
                        <small>חלפי AC שיישארו</small>
                        <div id="spareAC" class="val">0</div>
                    </div>
                    <div class="spare-box">
                        <small>חלפי DC שיישארו</small>
                        <div id="spareDC" class="val">0</div>
                    </div>
                </div>

                <h3>רשימת מק"טים לרכש (BOM)</h3>
                <table class="bom-table" id="bomTable">
                    <thead>
                        <tr>
                            <th>תיאור/מק"ט</th>
                            <th style="width: 80px;">כמות</th>
                            <th class="no-print"></th>
                        </tr>
                    </thead>
                    <tbody id="bomBody">
                    </tbody>
                </table>
                <button class="btn-add no-print" onclick="addRow()">+ הוסף מק"ט ידנית</button>

                <div class="export-buttons">
                    <button class="btn-print no-print" onclick="window.print()">📄 דוח PDF</button>
                    <button class="btn-excel no-print" onclick="exportToExcel()">📥 טבלת רכש (Excel)</button>
                </div>
            </section>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
